---
title: "Teletrabajo y Salud Mental"
author: "Paula Quirós, Carlota García y Alma Caneiro"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true 
--- 
<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Enlace al repositorio

[Repositorio de GitHub](https://github.com/Carlota12N/seminario-teletrabajo-saludmental.git) 


# Introducción

La relación entre la salud mental y el empleo, especialmente en los trabajos que implican muchas horas frente a un ordenador, ha cobrado una importancia creciente en los últimos años debido al aumento de episodios depresivos y estrés laboral entre la población trabajadora. 
Diversos estudios señalan que el teletrabajo puede ofrecer ventajas como la mejora de la conciliación o la reducción de desplazamientos, pero también puede favorecer el aislamiento, la dificultad para desconectar y la sensación de sobrecarga emocional.

En este seminario analizamos hasta qué punto el teletrabajo se asocia con la salud mental en España, centrándonos en los episodios depresivos y en el riesgo de mala salud mental. 

Para ello, combinamos datos estatales de prevalencia de depresión por comunidades autónomas con indicadores de teletrabajo tanto a nivel autonómico como provincial, y realizamos un análisis específico del caso de las Islas Canarias, donde disponemos de información detallada por isla. A través de esta integración de bases de datos públicos y visualizaciones interactivas, exploramos si las regiones con mayor implantación del teletrabajo presentan también peores indicadores de salud mental, identificamos excepciones a esta tendencia y estudiamos cómo el contexto económico y territorial puede modificar la relación entre trabajo remoto y bienestar psicológico.

#  Objetivos

## Objetivo General
**Demostrar si es que existe, la relación entre episodios depresivos y el teletrabajo, en la actualidad. **


## Objetivos Específicos

**1.** Comparar los valores del teletrabajo y la depresión en las distintas comunidades autónomas para el tipo de tendencia que siguien.

**2.** Análisis de las excepciones a la tendencia.

**3.** ¿Qué pasa en un lugar específico? Analizar en detalle el caso de las Islas Canarias para evaluar si la población que teletrabaja presenta un mayor riesgo de problemas de salud mental.


# Metodología y Resultados

A continuación cargamos las siguientes librerias.

```{r librerias, eval=TRUE, message=FALSE, warning=FALSE}

library(tidyverse) 
library(readr)    


library(rjson)
library(tidyjson)

library(ggplot2)   # Gráficos estáticos
library(plotly)    # Gráficos interactivos
library(DT)        # Tablas interactivas
library(mapSpain)  # Para los mapas
library(gganimate)

```

## Cargamos los archivos

Seguidamente cargamos los archivos.
Los datos los hemos obtenido de fuentes oficiales como el Instituto Nacional de Estadística y el portal datos.gob.es, además del Instituto Canario de Estadística (ISTAC).

### Cargamos el primer archivo episodios depresivos.csv

Iniciamos cargando el archivo:`episodios depresivos.csv`.

```{r carga_csv_depresion, eval=TRUE}
# Cargamos el archivo CSV de episodios depresivos

depresion_raw <- read_delim(
  "input/data/episodios_depresivos.csv",
  delim = ";",
  escape_double = FALSE,
  trim_ws = TRUE,
  locale = locale(encoding = "ISO-8859-1")
)


# Mostramos la tabla para ver cómo ha salido
datatable(depresion_raw)
```

### Cargamos el archivo teletrabajo_por_comunidad.csv

Necesitamos cargar el archivo: `teletrabajo_por_comunidad.csv`.

```{r carga_csv_teletrabajo, eval=TRUE}
teletrabajo_comunidad_raw <- read_delim(
  "input/data/teletrabajo_por_comunidad.csv",
  delim = ";",
  escape_double = FALSE,
  trim_ws = TRUE,
  locale = locale(encoding = "ISO-8859-1")
)

datatable(teletrabajo_comunidad_raw)
```

### Cargamos el archivo teletrabajoporporprovincias.csv

A continuación, cargamos el archivo: `teletrabajoporprovincias.csv`.

```{r carga_csv_teletrabajoporprovincias, eval=TRUE}
teletrabajo_provincias_raw <- read_delim(
  "INPUT/DATA/teletrabajoporprovincias.csv",
  delim = ",",
  escape_double = FALSE,
  trim_ws = TRUE,
  locale = locale(encoding = "ISO-8859-1")
)
datatable(teletrabajo_provincias_raw)
```

### Cargamos el archivo JSON de datos de salud mental en Canarias

Finalmente, cargamos el archivo: `salud_mental_canarias.json`

```{r carga_json_canarias_manual, eval=TRUE, message=FALSE, warning=FALSE}


# Cargar el archivo JSON
json_data <- fromJSON(file = "input/data/saludmentalcanarias.json")

valores <- sapply(json_data$data, function(x) x$Valor)

codigos_list <- lapply(json_data$data, function(x) x$dimCodes)
codigos_matriz <- do.call(rbind, codigos_list)

df_sucio <- data.frame(
  Valor = as.numeric(valores),
  Codigo_Isla = codigos_matriz[, 1],   # Columna 1: Isla
  Codigo_Tipo = codigos_matriz[, 2],   # Columna 2: Absoluto/Porcentaje
  Codigo_Estado = codigos_matriz[, 3]  # Columna 3: Estado Mental
)


# Leyenda de Islas
leyenda_islas <- data.frame(
  Codigo_Isla = json_data$categories[[1]]$codes,
  Nombre_Isla = json_data$categories[[1]]$labels
)

# Leyenda de Estados de Salud Mental
leyenda_estado <- data.frame(
  Codigo_Estado = json_data$categories[[3]]$codes,
  Descripcion_Estado = json_data$categories[[3]]$labels
)

# Unir todo para tener la tabla final, usamos un left join
salud_mental_canarias <- df_sucio %>%
  left_join(leyenda_islas, by = "Codigo_Isla") %>%
  left_join(leyenda_estado, by = "Codigo_Estado") %>%
  # Filtramos para ver porcentajes y el estado "6 o más síntomas" (indicador de problema)
  filter(Codigo_Tipo == "Porcentaje") %>%
  select(Nombre_Isla, Descripcion_Estado, Valor)

datatable(salud_mental_canarias)
```

## Limpieza de datos

### Limpieza de episodios_depresivos.csv

```{r limpieza_depresion_intensidad, eval=TRUE, message=FALSE, warning=FALSE}

#Limpiamos y filtramos 
depresion_intensidad <- depresion_raw %>%
  # Quitamos el Total Nacional
  filter(`Comunidades y Ciudades Autónomas` != "Total Nacional") %>%
  filter(!is.na(`Comunidades y Ciudades Autónomas`)) %>%
  
  # Convertimos a número
  mutate(
    Valor_Numerico = as.numeric(gsub(",", ".", gsub("\\.", "", Total)))
  ) %>%
  
  # Nos quedamos con "Ambos sexos"
  filter(Sexo == "Ambos sexos") %>% 
  
  # Calculamos el porcentaje
  group_by(`Comunidades y Ciudades Autónomas`) %>%
  mutate(
    Total_Poblacion = Valor_Numerico[`Intensidad depresión` == "TOTAL"],
    # Redondeamos a 2 decimales
    Porcentaje = round((Valor_Numerico / Total_Poblacion) * 100, 2)
  ) %>%
  ungroup() %>%
  
  # ELIMINAR TOTAL: 
  filter(`Intensidad depresión` != "TOTAL") %>%
  
  # Limpiamos nombre de la comunidad
  mutate(
    Comunidad = trimws(gsub("^[0-9]+", "", `Comunidades y Ciudades Autónomas`))
  ) %>%
  
  # Seleccionamos columnas finales
  select(Comunidad, Intensidad = `Intensidad depresión`, Porcentaje)

# Mostramos la tabla
datatable(depresion_intensidad)
```

### Gráfico que muestra los episodios depresivos de los habitantes de cada comunidad en España

```{r grafico_intensidad_depresion, eval=TRUE, message=FALSE, warning=FALSE}
# Filtramos los datos para excluir la categoría "Ninguna" y "No consta"
depresion_con_sintomas <- depresion_intensidad %>%
  filter(!Intensidad %in% c("Ninguna", "No consta")) %>%
  
  # Ordenamos las comunidades por el porcentaje total de depresión para un gráfico limpio
  group_by(Comunidad) %>%
  mutate(Total_Depresion = sum(Porcentaje)) %>%
  ungroup() %>%
  arrange(desc(Total_Depresion)) %>%
  
  # Convertimos la comunidad a factor para mantener el orden en el gráfico
  mutate(Comunidad = factor(Comunidad, levels = unique(Comunidad)))

#Creamos el gráfico de barras agrupadas
grafico_intensidad <- ggplot(depresion_con_sintomas, 
                             aes(x = Comunidad, y = Porcentaje, fill = Intensidad)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
  scale_fill_brewer(palette = "Reds", direction = -1, 
                    name = "Intensidad",
                    breaks = c("Grave", "Moderadamente grave", "Moderada", "Leve")) +
  coord_flip() +
  labs(
    title = "Prevalencia y Severidad de Episodios Depresivos por CCAA",
    subtitle = "El porcentaje es sobre el total de la población de cada Comunidad.",
    x = "",
    y = "Porcentaje de Población (%)"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")

ggplotly(grafico_intensidad)
```

En este gráfico de barras apiladas observamos la prevalencia de la depresión en cada comunidad autónoma desglosada por gravedad, las barras mas largas indican un mayor porcentaje de población afectada. 


### Limpieza de teletrabajo_por_comunidad


```{r limpieza_teletrabajo_ocupados, eval=TRUE, message=FALSE, warning=FALSE}

# Limpiamos para tener SOLO una fila por Comunidad (Trabajadores que teletrabajan)
teletrabajo_ocupados <- teletrabajo_comunidad_raw %>%
  # Quitamos Total Nacional y vacíos
  filter(`Comunidades y Ciudades Autónomas` != "Total Nacional") %>%
  filter(!is.na(`Comunidades y Ciudades Autónomas`)) %>%
  
  # Nos quedamos SOLO con el grupo de "Personas ocupadas"
  filter(`Clase de población` == "Personas ocupadas") %>%
  
  # Nos quedamos con los que sí teletrabajan
  filter(Teletrabajo == "Personas que han teletrabajado") %>%
  
  # Limpiamos el nombre de la Comunidad
  mutate(
    Comunidad = trimws(gsub("^[0-9]+", "", `Comunidades y Ciudades Autónomas`))
  ) %>%
  
  # Convertimos el porcentaje a número
  mutate(
    Porcentaje_Teletrabajo_Ocupados = as.numeric(gsub(",", ".", Total))
  ) %>%
  
  # Seleccionamos solo Nombre y Porcentaje
  select(Comunidad, Porcentaje_Teletrabajo_Ocupados)

# Mostramos la tabla
datatable(teletrabajo_ocupados)
```

### Gráfico que muestra porcentajes de teletrabajo de los habitantes de cada comunidad en España

```{r grafico_teletrabajo_ccaa, eval=TRUE, message=FALSE, warning=FALSE}
# Creamos el gráfico de barras horizontal
grafico_teletrabajo <- ggplot(teletrabajo_ocupados, 
                              aes(x = Porcentaje_Teletrabajo_Ocupados, 
                                  # Ordenamos las CCAA de menor a mayor porcentaje
                                  y = reorder(Comunidad, Porcentaje_Teletrabajo_Ocupados))) +
  
  geom_col(aes(fill = Porcentaje_Teletrabajo_Ocupados), width = 0.8) +
  
  # Añadimos etiquetas con el porcentaje exacto al final de cada barra
  geom_text(aes(label = paste0(Porcentaje_Teletrabajo_Ocupados, "%")), 
            hjust = -0.1, size = 3) + 
  
  scale_fill_gradient(low = "#b2e2e2", high = "#225ea8", name = "Porcentaje") +
  
  labs(
    title = "Penetración del Teletrabajo en la Población Ocupada por CCAA",
    subtitle = "El porcentaje es sobre el total de personas con empleo.",
    x = "Porcentaje de Teletrabajadores (%)",
    y = "" 
  ) +
  theme_minimal() +
  theme(
    legend.position = "none", 
    panel.grid.major.y = element_blank() # Quitamos las líneas horizontales
  )

# Hacemos el gráfico
ggplotly(grafico_teletrabajo)

```

Este gráfico clasifica a las comunidades autónomas según su adopción del teletrabajo. Se hace evidente una brecha digital y laboral. En la parte superior encontramos a Madrid y a Cataluña que lideran debido a su tejido empresarial. En la parte inferior comunidades como Castilla y León donde la economía depende de sectores presenciales como la agricultura. 

### Limpieza de teletrabajoporprovincias

```{r limpieza_teletrabajo_personal_provincias, eval=TRUE, message=FALSE, warning=FALSE}


# Limpiamos y filtramos
teletrabajo_personal_canarias <- teletrabajo_provincias_raw%>%
  # Nos quedamos solo con el indicador de "PERSONAL TOTAL"
  filter(indicadores_nombre == "Porcentaje del personal total que es teletrabajador") %>%
  
  # Quitamos el total de "Canarias" para ver solo las islas
  filter(islas_nombre != "Canarias") %>%
  
  # Creamos la columna PROVINCIA (asignando cada isla a la suya)
  mutate(
    Provincia = case_when(
      islas_nombre %in% c("Gran Canaria", "Lanzarote", "Fuerteventura") ~ "Las Palmas",
      islas_nombre %in% c("Tenerife", "La Palma", "La Gomera", "El Hierro") ~ "S.C. Tenerife",
      TRUE ~ "Otra"
    )
  ) %>%
  
  # Seleccionamos y renombramos las columnas finales
  select(
    Provincia,
    Isla = islas_nombre, 
    Porcentaje_Personal_Teletrabajador = teletrabajo_porcentaje_empresas_teletrabajadores_personal_trabajaba_fuera_locales_empresa
  ) %>%
  
  # Ordenamos por provincia
  arrange(Provincia)

# Mostramos la tabla
datatable(teletrabajo_personal_canarias)
```

### Gráfica sobre el teletrabajo centrándonos en las Islas canarias

```{r grafico_teletrabajo_islas, eval=TRUE, message=FALSE, warning=FALSE}
# Creamos el gráfico de barras horizontal agrupado por Provincia
grafico_teletrabajo_islas <- ggplot(teletrabajo_personal_canarias, 
                              aes(x = Porcentaje_Personal_Teletrabajador, 
                                  # Ordenamos las islas de menor a mayor teletrabajo dentro de cada provincia
                                  y = reorder(Isla, Porcentaje_Personal_Teletrabajador))) +
  
  # Usamos el color de la barra para diferenciar la Provincia
  geom_col(aes(fill = Provincia), width = 0.7) +
  
  # Añadimos etiquetas con el porcentaje exacto
  geom_text(aes(label = paste0(Porcentaje_Personal_Teletrabajador, "%")), 
            hjust = -0.1, size = 3) + 
  
  # Separamos el gráfico en dos paneles por Provincia
  facet_wrap(~ Provincia, scales = "free_y", ncol = 1) + 
  
  scale_fill_manual(values = c("Las Palmas" = "#1b9e77", "S.C. Tenerife" = "#d95f02")) +
  
  labs(
    title = "Porcentaje de Personal Teletrabajador en las Islas Canarias",
    subtitle = "Comparación por Isla y Provincia.",
    x = "Porcentaje de Personal Teletrabajador (%)",
    y = ""
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    panel.grid.major.y = element_blank(),
    strip.text = element_text(face = "bold") # Hace que el título de la provincia sea negrita
  )

# Hacemos el gráfico 
ggplotly(grafico_teletrabajo_islas)
```

Al poner el foco en Canarias, observamos Gran Canaria y Tenerife con las tasas mas altas de teletrabajo y Lanzarote o Fuerteventura con las mas bajas. Esto refleja la estructura económica de cada isla, las que dependen exclusivamente del turismo tienen muy poca capacidad de adaptación al trabajo remoto. 

### Limpieza de saludmentalcanaria.json

```{r limpieza_salud_canarias_final_corregida, eval=TRUE, message=FALSE, warning=FALSE}

# Extracción de valores y códigos
valores <- sapply(json_data$data, function(x) x$Valor)
codigos_list <- lapply(json_data$data, function(x) x$dimCodes)
codigos_matriz <- do.call(rbind, codigos_list)

# Descifrar los nombres
leyenda_islas <- data.frame(
  Codigo_Isla = json_data$categories[[1]]$codes,
  Nombre_Isla = trimws(json_data$categories[[1]]$labels) 
)
leyenda_estado <- data.frame(
  Codigo_Estado = json_data$categories[[3]]$codes,
  Descripcion_Estado = trimws(json_data$categories[[3]]$labels)
)

# LIMPIEZA FINAL Y UNIÓN
salud_mental_final <- data.frame(
  Valor = as.numeric(valores),
  Codigo_Isla = codigos_matriz[, 1],
  Codigo_Tipo = codigos_matriz[, 2],
  Codigo_Estado = codigos_matriz[, 3]
) %>%
  left_join(leyenda_islas, by = "Codigo_Isla") %>%
  left_join(leyenda_estado, by = "Codigo_Estado") %>%
  
  # Nos quedamos solo con PORCENTAJES
  filter(Codigo_Tipo == "Porcentaje") %>%
  
  # Eliminamos cualquier etiqueta que contenga un guion "-" (que indica sub-región) y eliminamos el total "CANARIAS".
  filter(!str_detect(Nombre_Isla, "-|CANARIAS")) %>%

  # Creamos la columna provincia
  mutate(
    Provincia = case_when(
      Nombre_Isla %in% c("Lanzarote", "Fuerteventura", "Gran Canaria") ~ "Las Palmas",
      Nombre_Isla %in% c("Tenerife", "La Palma", "La Gomera", "El Hierro") ~ "S.C. Tenerife",
      TRUE ~ "Otra"
    )
  ) %>%
  
  # Seleccionamos las columnas finales
  select(Provincia, Isla = Nombre_Isla, Estado_Mental = Descripcion_Estado, Porcentaje = Valor) %>%
  arrange(Provincia, Isla)

# Mostramos la tabla limpia
datatable(salud_mental_final)
```

### Grafica sobre la salud mental centrándonos en las Islas canarias

```{r grafico_salud_intensidad_canarias, eval=TRUE, message=FALSE, warning=FALSE}
#Ordenamos las Islas por su porcentaje de riesgo más alto para un gráfico limpio
salud_mental_ordenada <- salud_mental_final %>%
  filter(Estado_Mental == "6 o más") %>%
  arrange(desc(Porcentaje)) %>%
  pull(Isla)

# Creamos el gráfico de barras apiladas
grafico_salud_intensidad <- ggplot(salud_mental_final, 
                                     aes(x = Porcentaje, 
                                         # Usamos el factor ordenado para la Islas
                                         y = factor(Isla, levels = rev(salud_mental_ordenada)), fill = Estado_Mental)) +  # Rellenamos con el estado mental 
  
  geom_bar(stat = "identity", position = "stack", width = 0.8) +
  
  # Usamos facet_wrap para separar el análisis por Provincia
  facet_wrap(~ Provincia, scales = "free_y", ncol = 1) +
  
  # Colores: Usamos una escala que va de azul/verde (saludable) a rojo (riesgo)
  scale_fill_manual(
    name = "Síntomas de Mala Salud Mental",
    values = c("0" = "#a1d99b", "1" = "#edf8e9", "2" = "#fed98e", "3" = "#fe9929", "4" = "#d95f0e", "5" = "#993404", "6 o más" = "#7f0000"),
    breaks = c("0", "1", "2", "3", "4", "5", "6 o más", "No consta") # Ordenamos la leyenda
  ) +
  
  labs(
    title = "Perfiles de Salud Mental en las Islas Canarias",
    subtitle = "Distribución del porcentaje de la población según el número de síntomas (0 a 6 o más).",
    x = "Porcentaje de Población (%)",
    y = "Isla"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.grid.major.y = element_blank(),
    strip.text = element_text(face = "bold")
  )

# Hacemos el gráfico interactivo
ggplotly(grafico_salud_intensidad)
```

Este gráfico es una muestra completa de la salud mental en el archipiélago. LLama la atención como las islas varían en la proporción de colores ocuros, que son los que indican un mayor número de síntomas de mala salud mental.

## Relacion entre teletrabajo y salud mental en España por comunidades

```{r objetivo1_union_grafico, eval=TRUE, message=FALSE, warning=FALSE}
# Agregamos el porcentaje de depresión por CCAA
# Sumamos todos los porcentajes, excluyendo "Ninguna" y "No consta"
depresion_agregada <- depresion_intensidad %>%
  filter(!Intensidad %in% c("Ninguna", "No consta")) %>%
  group_by(Comunidad) %>%
  summarise(
    Porcentaje_Con_Depresion = sum(Porcentaje, na.rm = TRUE),
    .groups = 'drop'
  )

# Unimos los datos de Depresión y Teletrabajo por la columna "Comunidad"
datos_finales_obj1 <- left_join(depresion_agregada, teletrabajo_ocupados, by = "Comunidad")

# Mostramos la tabla final unida
datatable(datos_finales_obj1)
```

```{r objetivo1_grafico, eval=TRUE, message=FALSE, warning=FALSE}
# Creamos el gráfico de dispersión (scatter plot)
grafico_obj1 <- ggplot(datos_finales_obj1, aes(x = Porcentaje_Teletrabajo_Ocupados, y = Porcentaje_Con_Depresion)) +
  geom_point(aes(color = Comunidad), size = 4) + # Puntos coloreados por CCAA
  geom_smooth(method = "lm", se = TRUE, color = "#1f77b4", linetype = "dashed") + # Línea de tendencia (LM)
  labs(
    title = "Relación entre Teletrabajo y Depresión por Comunidad Autónoma",
    subtitle = "El eje X es el % de trabajadores que teletrabajan. El eje Y es el % de población con depresión.",
    x = "Población que Teletrabaja (% de Ocupados)",
    y = "Población con Episodios Depresivos (%)",
    color = "Comunidad"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")

# Vemos el gráfico
ggplotly(grafico_obj1)
```

Este diagrama de dispersión es la clave del objetivo 1. La línea de tendencia nos confirma que existe una correlación positiva. A nivel nacional las comunidades con más teletrabajo tienden a tener mayores tasas de depresión. 
Sin embargo observamos excepciones. Esto valida nuestro objetivo 2, en la "España vaciada" la depresión se dispara. 

## Relacion entre teletrabajo y salud mental en las Islas Canarias 
```{r tabla_objetivo2_canarias, eval=TRUE, message=FALSE, warning=FALSE}
# Filtramos el indicador de ALTO RIESGO de salud mental ("6 o más")
salud_mental_riesgo <- salud_mental_final %>%
  filter(Estado_Mental == "6 o más") %>%
  select(Isla, Porcentaje_Riesgo = Porcentaje)

# Unimos con los datos de teletrabajo
datos_canarias_final <- left_join(teletrabajo_personal_canarias, salud_mental_riesgo, by = "Isla")

# 2. Generación de la Tabla
datatable(datos_canarias_final, 
          options = list(pageLength = 10, autoWidth = TRUE),
          caption = "Tabla: Relación entre el % de Personal Teletrabajador y el % de Población con Alto Riesgo Mental (6 o más síntomas) por Isla.")
```

```{r objetivo2_canarias_analisis, eval=TRUE, message=FALSE, warning=FALSE}
# FILTRO: Obtenemos el indicador de ALTO RIESGO de salud mental por Isla
salud_mental_riesgo <- salud_mental_final %>%
  filter(Estado_Mental == "6 o más") %>%
  select(Isla, Porcentaje_Riesgo = Porcentaje) # Renombramos la columna Valor a Porcentaje_Riesgo

# UNIÓN: Cruzamos el riesgo de salud mental con el porcentaje de teletrabajo
datos_canarias_final <- left_join(teletrabajo_personal_canarias, salud_mental_riesgo, by = "Isla")

# VISUALIZACIÓN: Scatter plot para ver la correlación en ambas provincias

grafico_obj2 <- ggplot(datos_canarias_final, aes(x = Porcentaje_Personal_Teletrabajador, y = Porcentaje_Riesgo)) +
  geom_point(aes(color = Isla, text = paste("Isla:", Isla, "<br>Riesgo:", Porcentaje_Riesgo, "%")), size = 5) + # Usamos text para el tooltip de plotly
  geom_smooth(method = "lm", se = FALSE, color = "gray", linetype = "dotted") +
  
  # Usamos facet_wrap para separar el análisis por provincia
  facet_wrap(~ Provincia, scales = "free") +
  
  labs(
    title = "Teletrabajo vs. Riesgo de Problemas de Salud Mental en Canarias",
    subtitle = "El eje Y es el porcentaje de población con 6 o más síntomas (alto riesgo).",
    x = "Personal Teletrabajador (%)",
    y = "Población con Alto Riesgo Mental (%)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

# Convertimos a interactivo para ver los detalles
ggplotly(grafico_obj2, tooltip = "text")
```

Este último gráfico nos muestra el hallazgo más importante: la inversión de la tendencia nacional. En Canarias el teletrabajo actúa como un factor protector, quién puede teletrabajar, suele tener un empleo más estable lo que se traduce en una mejor salud mental frente a la incertidumbre del sector turístico presencial. 


# Conclusiones 

### Conclusiones de los objetivos específicos

**1. Comparar los numeros del teletrabajo y la depresión en las distintas comunidades autónomas para ver que tipo de tendencia siguen.**

Hemos observado una clara tendencia ascendente confirmando que las comunidades autónomas con mayor porcentaje de teletrabajadores como por ejemplo Madrid o Cataluña son tambien las que tienen el mayor porcentaje de poblacion con depresión, en cambio las comunidades con menos implantación de teletrabajo (Castilla La Mancha, Cantabria) se situan consistentemente en los niveles mas bajos de depresión.
Destacamos que hay comunidades que se salen de lo establecido como Castilla y León que con un bajo porcentaje de pobalción teletrabajadora muestra el mayor nivel de población con niveles depresivos. 

**2. Analisis de las excepciones a la tendencia.**

Aun que la tendencia nacional es que "a mas teletrabajo mas depresión" comunidades como Castilla y León o Galicia rompen esta regla, se situan en la zona de bajo teletrabajo pero altos niveles de depresión. Esto desmuesta que el teletrabajo no es el único culpable en estas comunidades si no que factores demográficos como el envejecimiento de la población y la dispersión rural tienen un peso mucho mayor en la salud mental que la modalidad de teletrabajo que estamos analizando. 

Mientras que en Madrid el estrés puede venir de la hiperconexión y el teletrabajo en Castilla y León el riesgo para la salud mental proviene de otros factores, lo que genera cifras altas de depresión sin necesidad de teletrabajo. 

**3. ¿Qué pasa en un lugar específico? Estudiamos de cerca las islas canarias para ver si la gente que teletrabaja tiene mas riesgo mental. **

Al contrario de lo que ocurre a nivel nacional, en las Islas Canarias los datos muestran una tendencia inversa, podemos destacar el caso de la isla de Lanzarote, esta isla presenta una baja tasa de teletrabajo y un alto índice en el riesgo de salud mental.

En contraste a esto, encontramos a Gran Canaria y El Hierro que lideran el teletrabajo en las islas, pero presentan niveles de riesgo mental signitivamente más bajos. 

Esto puede corresponderse a que las islas con menos teletrabajo como hemos dicho Lanzarote dependen casi exclusivamente de sectores presenciales (el turismo intensivo). Lo que las hace más vulnerables a inestabilidades económicas y laborables, disparando los índices de depresión. 

Los datos de El Hierro y Gran Canaria nos revelan el matiz crucial en el archipiélago, el teletrabajo parece actuar como un factor protector asociado a la inestabilidad laboral. En estas islas tener un trabajo que permita teletrabajar es un privilegio que portege tu salud mental frente a la incertidumbre económica que nos puede provocar el turismo.


### Conclusión General

El objetivo general era ver si existe una conexión entre el teletrabajo y la salud mental en la población española.

Los resultados demuestran una correlación positiva entre la penetración del teletrabajo entre las comunidades autónomas y la prevalencia de episodios depresivos. Esta relación sugiere que los entornos con una estructura laboral que facilita el teletrabajo (típicamente grandes ciudades) son también aquellos donde la población reporta grandes problemas de salud mental. 

Sin embargo esta correlación no implica causalidad, ambas variables pueden ser impulsadas por un tercer factor, el tipo de actividad económica, envejecimiento de la población o dispersión rural. 

El teletrabajo no es la causa directa de la depresión por si mismo, más bien actúa como un indicador de la estructura económica de cada región. En la Península señala zonas saturadas y estresadas, mientras que en territorios insulares y fragmentados, su presencia es sinónimo de calidad y seguridad laboral protegiendo la salud mental de teletrabajos. 


# Bibliografía

Tomasina, F., & Pisani, A. (2022). Pros y contras del teletrabajo en la salud física y mental de la población general trabajadora: una revisión narrativa exploratoria. Archivos de Prevención de Riesgos Laborales, 25(2), 147-161. https://doi.org/10.12961/aprl.2022.25.02.07

Inicio ISTAC - Gobierno de Canarias. (s. f.). https://www.gobiernodecanarias.org/istac/

INE - Instituto Nacional de Estadística. (s. f.). INE. Instituto Nacional de Estadística. INE. https://www.ine.es/

Datos abiertos del Gobierno de España | datos.gob.es. (s. f.). Datos Abiertos del Gobierno de España | datos.gob.es. https://datos.gob.es/es/

